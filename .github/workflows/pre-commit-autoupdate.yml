name: "Run pre-commit autoupdate"

on:
  workflow_call:

permissions:
  contents: write

defaults:
  run:
    shell: bash

jobs:
  precommit-autoupdate:
    name: "pre-commit autoupdate"
    runs-on: ubuntu-latest
    steps:
      - name: "Check out repository"
        uses: actions/checkout@v4
        with:
          persist-credentials: false

      - name: "Add brew to the PATH"
        run: echo "/home/linuxbrew/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/sbin" >> $GITHUB_PATH

      - name: "Install pre-commit"
        run: brew install pre-commit

      - name: "Check for pre-commit hook updates"
        id: pre-commit
        run: |
          pre-commit autoupdate
          updates=$(git diff --raw)
          echo "updates=$updates" >> $GITHUB_OUTPUT

      - name: "Create a PR if there are updates"
        if: ${{ steps.pre-commit.outputs.updates }}
        uses: ./.github/actions/commit-and-create-pull-request@pre-commit-auto-update
        with:
          message: "[automated] Update pre-commit hooks"
          title: "[Automated] Update pre-commit hooks"
          body: "Pre-commit hooks have updates that require resolution."
